---
title: "College's predicted profit by sport"
author: "Standard Deviants - Ava Exelbirt, Yura Heo, Claire Li"
date: "11/7/2023"
format: pdf
execute: 
  warning: false
  message: false
  echo: false
editor: visual
---

```{r}
#| label: load packages and data
library(tidyverse)
library(tidymodels)
library(skimr)
library(patchwork)
library(kableExtra)

sports <- read.csv("data/sports.csv")
```

#### Introduction and data

In our research project, we aim to investigate and understand the factors influencing the profit generated by collegiate sport, specifically basketball, in the school year 2019 to 2020. We will be utilizing a dataset sourced from Tidy Tuesday, which provides a comprehensive collection of observations related to collegiate sports, including information about the schools, classifications, sport types, and various quantitative variables describing the sport players and the schools' financial investment in sports programs in the dataset called "sports.csv". Our primary motivation for this research is to gain insights into the determinants of collegiate basketball profit, which can be of significant interest to educational institutions and further local policy makers and sports enthusiasts. Understanding the factors that contribute to profit generation in collegiate basketball sports can inform decision-making, investment strategies in sports, and future planning for universities and colleges involved in sports programs. We chose to do profit as our response variable because expenditures and revenue are closely related, so expenditure would overpower the other predictor variables if we were to predict revenue or expenditure. Therefore, we will create a new variable, profit calculated from revenue minus expenditures and predict this. 

```         
Our primary research question is as follows: **In the school year 2019 to 2020, how can we predict the profit (revenue- expenditure) in USD of the collegiate sport basketball using participation rate, school sector name, gender, total count of students, and school classification name.**
```

Our hypothesis is as follows: **Participation rate, sector name, and gender will be the most influential predictors for the total profit generated by the collegiate sport basketball in USD.**

The data set was taken from TidyTuesday and was originally scraped from Equity in Athletics Data Analysis (EADA), a sector of the US Department of Education. The data is available on an online database found on the (EADA) website1.

This data is submitted annually from colleges to the EADA. All co-educational postsecondary institutions that receive Title IV funding that have intercollegiate athletics programs are required by the Equity in Athletics Disclosure Act to submit this data. The original data files are also created immediately after the data collection for each school. These data are collected annually starting from 2003 to 2022, but for our specific data analysis we will only look at data taken from the school year of 2019 by cleaning the data to a new csv file which we will use for the rest of the project. The csv file from Tidy Tuesday contains thousands of observations from years 2015-2019, but we have adjusted the data file to only include the year 2019 and will filter the data to only include basketball as a sport, as this is our population we are analyzing.

The dataset we will use from the data scraped on Tidy Tuesday include many observations regarding collegiate sports. These observations include variables such as the name of the city which a school is in, the state, the school name, the classification of the school (like whether it is NCAA Division I, II, or III), the type/sector name of the school (like 4 year accredited university), sport, and many quantitative variables regarding characteristics about the specific school and their collegiate spending. Most of the quantitative variables are split between men and women, having two different observations for the same variable. For example, there is total male population, total female population, participation rate of women, participation rate of men, participation rate for coed sports for men, participation rate for coed sports for women, revenue for men, revenue for women, expenditures for men, and expenditures for women. There are also observations for the total amount for each of these above variables which includes both men and women; for example, total expenditures for both men and women together. The observations are therefore both quantitative and categorical and measure characteristics of different school's spending, revenue, populations, locations, and sports.

```         
The key variables we will use are **participation rate** which is the percentage of students who participate in sports, **sector school name** which is the type of school for example, public, 4-year or above, **gender** which is Male or Female for the context of this data, **total count of students** which is the total amount of students enrolled in the college, and **school classification name** which is a school\'s sports classification for example NCAA Division I-FCS. Then, our response variable is **profit** which is calculated by the total revenue of the school for basketball minus the expenditures of the school for basketball. 
```

For data cleaning, we need to filter for observations that have `Basketball` as the sports and filter out missing values. we also need to filter out observations that have missing values of the predictor variables we need in the model. We need to create new variables by mutation to turn variables involving revenue and expenditure into the unit of millions, so that we can get larger coefficients for better modeling.

```{r new-data, echo = FALSE}
basketball <- sports |>
  filter(sports == "Basketball") |>
  mutate(total_rev_mill = total_rev_menwomen / 1000000,
         total_exp_mill = total_exp_menwomen / 1000000) |>
  mutate(profit = total_rev_menwomen - total_exp_menwomen)
```

**Distribution of the response variable: total profit generated by college basketball**

```{r distribution-response, echo = FALSE, fig.width = 6, fig.height = 3}
basketball |>
  filter(profit > 0) |>
  ggplot(aes(x = profit)) +
  geom_histogram() +
  scale_x_log10() +
  labs(title = "Distribution of Total Revenue (in million $)",
       x = "Log 10 of the Positive Profits", y = "Count") +
  theme(plot.title = element_text(size = 10))



#scale_x_log10
#  filter bask to pos
  
#original_df, x > -100 
basketball |>
  skim(profit) |>
  select(-skim_type, -skim_variable, -complete_rate,
         - numeric.hist) |> 
  print(width = Inf) 
```

```{r}

```

The distribution is right-skewed, as most observations are at the lower end of the x axis with a number of outliers having very high values. The center is the median of 0.431111 million dollars due to the apparent skewness. Since the distribution is skewed, the IQR is used as a more reliable measure of spread which is Q3 - Q1 = 1.098081 - 0.19334 = 0.904741 million dollars. There are 57 missing values of total revenue.

**Distributions of total expenditure (potential quantitative predictor variable) and type of school (potential categorical predictor variable)**

```{r pred-dist, echo = FALSE, fig.width = 7, fig.height = 3}
p_exp <- basketball |>
  ggplot(aes(x = total_exp_mill)) +
  geom_histogram() +
  labs(title = "Distribution of Total Expenditure \n (in million $)",
  x = "Total expenditure \n (in million $)", y = "Count") +
   theme(plot.title = element_text(size = 10))

p_type <- basketball |>
  group_by(sector_name) |>
  count() |>
  ggplot(aes(x = sector_name, y = n)) +
  geom_boxplot() +
  coord_flip() +
  labs(title = "Distribution of Types of School",
       x = "Types of school", y = "Count") + 
   theme(plot.title = element_text(size = 10), 
         axis.text.y = element_text(size = 5))

p_exp + p_type

t_exp <- basketball |>
  skim(total_exp_mill) |>
  select(-skim_type, -skim_variable, -complete_rate,
         - numeric.hist) |> 
  print(width = Inf) 

cat_statistics <- function(x) {
  nmiss <- sum(is.na(x))
  n     <- table(x)
  p     <- prop.table(n)
  OUT   <- cbind(n, p)
  nmiss <- c(nmiss, rep(NA, nrow(OUT)-1))
  OUT   <- cbind(OUT, nmiss)
  return(OUT)
}
cat_statistics(basketball$sector_name)
```

**The relationships between total revenue and each of the predictors**

```{r reps-pred, echo = FALSE, fig.width = 7}
basketball_f <- basketball |>
  filter(!is.na(total_exp_mill),
         !is.na(total_rev_mill))

p_rev_exp <- basketball_f |>
  ggplot(aes(x = total_exp_mill,
             y = total_rev_mill)) +
  geom_point() +
  labs(title = "Total Revenue vs. \n Total Expenditure",
  x = "Total expenditure \n (in million $)", 
  y = "Total revenue (in million $)") + 
  theme(plot.title = element_text(size = 10))

p_rev_type <- basketball_f |>
  ggplot(aes(x = sector_name,
             y = total_rev_mill)) +
  geom_boxplot() +
  coord_flip() +
  labs(title = "Total Revenue vs. \n Type of School",
  x = "Type of school",
  y = "Total revenue (in million $)") + 
  theme(axis.text.y = element_text(size = 5),
        plot.title = element_text(size = 10))

p_rev_exp + p_rev_type

cor(basketball_f$total_exp_mill,
    basketball_f$total_rev_mill)
```

Potential interaction

```{r interact, echo = FALSE, fig.width = 7}
basketball_f |>
  ggplot(aes(x = ef_total_count,
             y = total_rev_mill,
             color = sector_name)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  scale_color_discrete(name = "Type of school") +
  labs(title = "Total Revenue vs. Total Number of Students",
       x = "Total number of students", y = "Total revenue (in million $)") + 
   theme(plot.title = element_text(size = 10), 
         axis.title.y = element_text(size = 8), 
         axis.title.x = element_text(size = 8))
```

#### Methodology

This section includes a brief description of your modeling process. Explain the reasoning for the type of model you're fitting, predictor variables considered for the model including any interactions. Additionally, show how you arrived at the final model by describing the model selection process, any variable transformations (if needed), and any other relevant considerations that were part of the model fitting process.

We plan to use a multiple linear regression to predict the profit profit (revenue - expenditure) in USD of the collegiate sport basketball using participation rate, school sector name, gender, total count of students, and school classification name. 

For the response variable, we decided to predict the profit, subtracting the expenditure variable from the revenue variable, instead of predicting the revenue variable and using the expenditure variable as a predictor because we anticipate that the revenue variable and the expenditure variable will have strong correlations. Expenditure will be strongly correlated with revenue of the sport basketball because schools often allocate significant financial resources to their sport programs, scholarships, and marketing. As these investments increase, the expectation is that they will have a direct impact on the overall revenue generated through different resources such as ticket sales. 

For this reason, we decided that using expenditure to predict the revenue will not produce a meaningful result in choosing the best predictors as expenditure may already significantly effect the revenue, muting the effects of all the other predictors. 

For the predictors, we anticipate that **participation rate** will be a key predictor of total profit of the sport basketball because schools may allocate more money to this sport if there is more participation from the students. We also expect that the type of school **(sector name**) will be a strong predictor of profit because different types of schools have varying levels of resources, alumni support, and participation rates in sports depending on school size and program. **Gender** is another predictor to consider because sports could be hugely dependent on the demographics of players. 

We also anticipate interaction effects which we will do further analysis in our results. Specifically, we believe the participation rate and the school sector type will have a correlation. This is because we expect participation rate to be very dependent based on the levels of investment, competitive levels, institutional culture, and student demographics which vary based on the type of institution(sector name). 

To prepare the variables for our analysis, we plan to use a recipe. First, we plan to drop all the NA values using step_naomit(). Then, we plan to drop variables using step_rm() such as sum of participation for men and women that we will not use to fit the model. Next, we plan to use step_zv() to remove all predictors that contain only a single value. Finally, we plan to create dummy variables using step_dummy() for all nominal predictors which are Classification name, Sector name, and Gender. 

#### Results

In this section, you will output the final model and include a brief discussion of the model assumptions, diagnostics, and any relevant model fit statistics.

This section also includes initial interpretations and conclusions drawn from the model.

::: callout-important
Before you submit, make sure your code chunks are turned off with `echo: false` and there are no warnings or messages with `warning: false` and `message: false` in the YAML.
:::
